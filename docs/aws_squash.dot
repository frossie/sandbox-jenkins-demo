digraph top {
//  dpi=100
  ranksep=1.25
  rankdir=TB
  overlap=false
  clusterrank=local
  newrank=true

  {
    node [shape=ellipse fontsize=24 style=filled fillcolor=white]
    ua [label="user-agent"]
    eip [label="elastic IP"]
    squash_vhost [label="vhost (squash)"]
    bokeh_vhost [label="vhost (bokeh)"]
    bokeh [label="bokeh"]
    rds [label="RDS (qadb)"]
    django [label="django (qa-dashboard)"]
  }

  color=lightgrey
  fontsize=18
  style=bold

  ua
  eip

  subgraph cluster_0 {
    label="VPC"

    subgraph cluster_1 {
      label="EC2 instance (squash)"

      subgraph cluster_2 {
        label="nginx"

        squash_vhost
        bokeh_vhost
      }

      subgraph cluster_3 {
        label="uwsgi"

        django
      }

      bokeh
    }

    rds

  }
  { rank=same; rds django bokeh }

  // https
  edge [color=red]
  ua -> eip
  eip -> squash_vhost
  eip -> bokeh_vhost
  django -> bokeh_vhost

  // http
  edge [color=orange]
  bokeh_vhost -> bokeh

  // mysql
  edge [color=blue]
  //django -> rds [constraint=false]
  django -> rds

  // uwsgi
  edge [color=khaki3]
  squash_vhost -> django
}
