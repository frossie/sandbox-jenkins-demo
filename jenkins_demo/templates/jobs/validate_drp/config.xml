<?xml version="1.0" encoding="UTF-8"?><matrix-project plugin="matrix-project@1.6">
  <actions/>
  <description/>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
      <autoRebuild>true</autoRebuild>
      <rebuildDisabled>false</rebuildDisabled>
    </com.sonyericsson.rebuild.RebuildSettings>
  </properties>
  <scm class="org.jenkinsci.plugins.multiplescms.MultiSCM" plugin="multiple-scms@0.6">
    <scms>
      <hudson.plugins.git.GitSCM plugin="git@2.4.2">
        <configVersion>2</configVersion>
        <userRemoteConfigs>
          <hudson.plugins.git.UserRemoteConfig>
            <url>https://github.com/lsst/lsstsw.git</url>
          </hudson.plugins.git.UserRemoteConfig>
        </userRemoteConfigs>
        <branches>
          <hudson.plugins.git.BranchSpec>
            <name>*/master</name>
          </hudson.plugins.git.BranchSpec>
        </branches>
        <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
        <submoduleCfg class="list"/>
        <extensions>
          <hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
            <relativeTargetDir>lsstsw</relativeTargetDir>
          </hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
          <hudson.plugins.git.extensions.impl.CloneOption>
            <shallow>true</shallow>
            <noTags>false</noTags>
            <reference/>
          </hudson.plugins.git.extensions.impl.CloneOption>
        </extensions>
      </hudson.plugins.git.GitSCM>
      <hudson.plugins.git.GitSCM plugin="git@2.4.2">
        <configVersion>2</configVersion>
        <userRemoteConfigs>
          <hudson.plugins.git.UserRemoteConfig>
            <url>https://github.com/lsst-sqre/buildbot-scripts.git</url>
          </hudson.plugins.git.UserRemoteConfig>
        </userRemoteConfigs>
        <branches>
          <hudson.plugins.git.BranchSpec>
            <name>*/master</name>
          </hudson.plugins.git.BranchSpec>
        </branches>
        <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
        <submoduleCfg class="list"/>
        <extensions>
          <hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
            <relativeTargetDir>buildbot-scripts</relativeTargetDir>
          </hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
          <hudson.plugins.git.extensions.impl.CloneOption>
            <shallow>true</shallow>
            <noTags>false</noTags>
            <reference/>
          </hudson.plugins.git.extensions.impl.CloneOption>
        </extensions>
      </hudson.plugins.git.GitSCM>
    </scms>
  </scm>
  <assignedNode>master</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <hudson.triggers.TimerTrigger>
      <spec>H H/8 * * *</spec>
    </hudson.triggers.TimerTrigger>
  </triggers>
  <concurrentBuild>true</concurrentBuild>
  <axes>
    <hudson.matrix.LabelAxis>
      <name>label</name>
      <values>
        <string>centos-6</string>
        <string>centos-7</string>
      </values>
    </hudson.matrix.LabelAxis>
    <hudson.matrix.TextAxis>
      <name>dataset</name>
      <values>
        <string>cfht</string>
        <string>decam</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.TextAxis>
      <name>python</name>
      <values>
        <string>py2</string>
      </values>
    </hudson.matrix.TextAxis>
  </axes>
  <combinationFilter>!(label=="centos-6" &amp;&amp; python=="py3")</combinationFilter>
  <builders>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -e

# allow access to lsstsw from jenkins-slave user
#sudo -iu "build${EXECUTOR_NUMBER}" chmod a+rx /home/build${EXECUTOR_NUMBER}

ARCHIVE="${WORKSPACE}/archive"
DRP="${WORKSPACE}/validate_drp"

# leave validate_drp results in workspace for debugging purproses but always start with a clean dir
rm -rf "$ARCHIVE" "$DRP"
mkdir -p "$ARCHIVE" "$DRP"</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>./buildbot-scripts/jenkins_wrapper.sh</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -e

ARCHIVE="${WORKSPACE}/archive"
DRP="${WORKSPACE}/validate_drp"
LSSTSW=${LSSTSW:-${WORKSPACE}/lsstsw}
LSSTSW_BUILD_DIR=${LSSTSW_BUILD_DIR:-${LSSTSW}/build}

cd "$DRP"

. "${LSSTSW}/bin/setup.sh"

eval "$(grep -E '^BUILD=' "$LSSTSW_BUILD_DIR"/manifest.txt)"

#DEPS=(pipe_tasks obs_cfht validation_data_cfht validate_drp)
#DEPS=(pipe_tasks obs_decam validation_data_decam validate_drp)
DEPS=(validate_drp)

for p in "${DEPS[@]}"; do
    setup "$p" -t "$BUILD"
done

#mkdir -p ~/.config/matplotlib
#echo "backend: agg" &gt; ~/.config/matplotlib/matplotlibrc

case "$dataset" in
  cfht)
    RUN="$VALIDATE_DRP_DIR/examples/runCfhtTest.sh"
    OUTPUT="${DRP}/Cfht_output_r.json"
    ;;
  decam)
    RUN="$VALIDATE_DRP_DIR/examples/runDecamTest.sh"
    OUTPUT="${DRP}/Decam_output_z.json"
    ;;
  *)
    &gt;&amp;2 echo "Unknown DATASET: $dataset"
    exit 1
    ;;
esac

#rm -f ~/.config/matplotlib/matplotlibrc
"$RUN" --noplot
cp "$OUTPUT" "$ARCHIVE"</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -e

ARCHIVE="${WORKSPACE}/archive"
DRP="${WORKSPACE}/validate_drp"
POST="${WORKSPACE}/post-qa"
LSSTSW=${LSSTSW:-${WORKSPACE}/lsstsw}
LSSTSW_BUILD_DIR=${LSSTSW_BUILD_DIR:-${LSSTSW}/build}

case "$dataset" in
  cfht)
    OUTPUT="${DRP}/Cfht_output_r.json"
    ;;
  decam)
    OUTPUT="${DRP}/Decam_output_z.json"
    ;;
  *)
    &gt;&amp;2 echo "Unknown DATASET: $dataset"
    exit 1
    ;;
esac

mkdir -p "$POST"
cd "$POST"

virtualenv venv
. venv/bin/activate
pip install post-qa==1.0.0

post-qa --lsstsw "$LSSTSW" --qa-json "$OUTPUT" --api-url "$SQUASH_URL/jobs/"  --api-user "$SQUASH_USER" --api-password "$SQUASH_PASS"</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.ArtifactArchiver>
      <artifacts>archive/**/*</artifacts>
      <allowEmptyArchive>false</allowEmptyArchive>
      <onlyIfSuccessful>false</onlyIfSuccessful>
      <fingerprint>true</fingerprint>
      <defaultExcludes>true</defaultExcludes>
      <caseSensitive>true</caseSensitive>
    </hudson.tasks.ArtifactArchiver>
    <org.jenkinsci.plugins.postbuildscript.PostBuildScript plugin="postbuildscript@0.17">
      <buildSteps>
        <hudson.tasks.Shell>
          <command>Z=$(lsof -d 200 -t)
if [[ ! -z $Z ]]; then
  kill -9 $Z
fi

rm -rf "${WORKDIR}/lsstsw/stack/.lockDir"
</command>
        </hudson.tasks.Shell>
      </buildSteps>
      <scriptOnlyIfSuccess>false</scriptOnlyIfSuccess>
      <scriptOnlyIfFailure>true</scriptOnlyIfFailure>
      <markBuildUnstable>false</markBuildUnstable>
      <executeOn>AXES</executeOn>
    </org.jenkinsci.plugins.postbuildscript.PostBuildScript>
    <jenkins.plugins.hipchat.HipChatNotifier plugin="hipchat@1.0.0">
      <token/>
      <room/>
      <matrixTriggerMode>BOTH</matrixTriggerMode>
      <startJobMessage/>
      <completeJobMessage/>
    </jenkins.plugins.hipchat.HipChatNotifier>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ansicolor.AnsiColorBuildWrapper plugin="ansicolor@0.4.2">
      <colorMapName>gnome-terminal</colorMapName>
    </hudson.plugins.ansicolor.AnsiColorBuildWrapper>
    <EnvInjectBuildWrapper plugin="envinject@1.92.1">
      <info>
        <propertiesContent>BRANCH=master
PRODUCT=validate_drp
SKIP_DEMO=true
NO_FETCH=false</propertiesContent>
        <loadFilesFromMaster>false</loadFilesFromMaster>
      </info>
    </EnvInjectBuildWrapper>
    <org.jenkinsci.plugins.builduser.BuildUser plugin="build-user-vars-plugin@1.5"/>
    <org.jenkinsci.plugins.credentialsbinding.impl.SecretBuildWrapper plugin="credentials-binding@1.6">
      <bindings>
        <org.jenkinsci.plugins.credentialsbinding.impl.UsernamePasswordMultiBinding>
          <credentialsId>squash-api-user</credentialsId>
          <usernameVariable>SQUASH_USER</usernameVariable>
          <passwordVariable>SQUASH_PASS</passwordVariable>
        </org.jenkinsci.plugins.credentialsbinding.impl.UsernamePasswordMultiBinding>
        <org.jenkinsci.plugins.credentialsbinding.impl.StringBinding>
          <credentialsId>squash-api-url</credentialsId>
          <variable>SQUASH_URL</variable>
        </org.jenkinsci.plugins.credentialsbinding.impl.StringBinding>
      </bindings>
    </org.jenkinsci.plugins.credentialsbinding.impl.SecretBuildWrapper>
  </buildWrappers>
  <executionStrategy class="hudson.matrix.DefaultMatrixExecutionStrategyImpl">
    <runSequentially>false</runSequentially>
  </executionStrategy>
</matrix-project>